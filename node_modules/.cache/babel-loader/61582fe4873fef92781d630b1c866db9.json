{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _reactRouterDom = require(\"react-router-dom\");\n\nvar _strapiHelperPlugin = require(\"strapi-helper-plugin\");\n\nvar _LeftMenu = require(\"../../components/LeftMenu\");\n\nvar _hooks = require(\"../../hooks\");\n\nvar _utils = require(\"./utils\");\n\nvar _init = _interopRequireDefault(require(\"./init\"));\n\nvar _reducer = _interopRequireWildcard(require(\"./reducer\"));\n\nvar _Loader = _interopRequireDefault(require(\"./Loader\"));\n\nvar _Wrapper = _interopRequireDefault(require(\"./Wrapper\"));\n\n/*\n *\n * LeftMenu\n *\n */\nvar LeftMenu = /*#__PURE__*/(0, _react.forwardRef)(function (_ref, ref) {\n  var shouldUpdateStrapi = _ref.shouldUpdateStrapi,\n      version = _ref.version,\n      plugins = _ref.plugins;\n  var location = (0, _reactRouterDom.useLocation)();\n  var permissions = (0, _react.useContext)(_strapiHelperPlugin.UserContext);\n\n  var _useSettingsMenu = (0, _hooks.useSettingsMenu)(true),\n      settingsMenu = _useSettingsMenu.menu; // TODO: this needs to be added to the settings API in the v4\n\n\n  var settingsLinkNotificationCount = (0, _react.useMemo)(function () {\n    if (shouldUpdateStrapi) {\n      return 1;\n    }\n\n    return 0;\n  }, [shouldUpdateStrapi]);\n\n  var _useReducer = (0, _react.useReducer)(_reducer[\"default\"], _reducer.initialState, function () {\n    return (0, _init[\"default\"])(_reducer.initialState, plugins, settingsMenu, settingsLinkNotificationCount);\n  }),\n      _useReducer2 = (0, _slicedToArray2[\"default\"])(_useReducer, 2),\n      _useReducer2$ = _useReducer2[0],\n      collectionTypesSectionLinks = _useReducer2$.collectionTypesSectionLinks,\n      generalSectionLinks = _useReducer2$.generalSectionLinks,\n      isLoading = _useReducer2$.isLoading,\n      pluginsSectionLinks = _useReducer2$.pluginsSectionLinks,\n      singleTypesSectionLinks = _useReducer2$.singleTypesSectionLinks,\n      dispatch = _useReducer2[1];\n\n  var generalSectionLinksFiltered = (0, _react.useMemo)(function () {\n    return (0, _utils.filterLinks)(generalSectionLinks);\n  }, [generalSectionLinks]);\n  var pluginsSectionLinksFiltered = (0, _react.useMemo)(function () {\n    return (0, _utils.filterLinks)(pluginsSectionLinks);\n  }, [pluginsSectionLinks]);\n  var singleTypesSectionLinksFiltered = (0, _react.useMemo)(function () {\n    return (0, _utils.filterLinks)(singleTypesSectionLinks);\n  }, [singleTypesSectionLinks]);\n  var collectTypesSectionLinksFiltered = (0, _react.useMemo)(function () {\n    return (0, _utils.filterLinks)(collectionTypesSectionLinks);\n  }, [collectionTypesSectionLinks]); // TODO:\n  // This is making a lot of request especially for the Author role as all permissions are being sent to\n  // to the backend.\n  // We should improve this by sending one request in with all permissions in bulk using the\n  // findMatchingPermissions util from the helper plugin and the /users/me/permissions endPoint\n\n  var checkPermissions = /*#__PURE__*/function () {\n    var _ref2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee(index, permissionsToCheck) {\n      var hasPermission;\n      return _regenerator[\"default\"].wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return (0, _strapiHelperPlugin.hasPermissions)(permissions, permissionsToCheck);\n\n            case 2:\n              hasPermission = _context.sent;\n              return _context.abrupt(\"return\", {\n                index: index,\n                hasPermission: hasPermission\n              });\n\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function checkPermissions(_x, _x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var generateArrayOfPromises = function generateArrayOfPromises(array) {\n    return array.map(function (_, index) {\n      return checkPermissions(index, array[index].permissions);\n    });\n  };\n\n  var getModels = /*#__PURE__*/function () {\n    var _ref3 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2() {\n      var requestURL, _yield$request, data, formattedData, collectionTypesSectionLinksArrayOfPromises, collectionTypesSectionResults, singleTypesSectionLinksArrayOfPromises, singleTypesSectionResults;\n\n      return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              requestURL = '/content-manager/content-types';\n              _context2.prev = 1;\n              _context2.next = 4;\n              return (0, _strapiHelperPlugin.request)(requestURL, {\n                method: 'GET'\n              });\n\n            case 4:\n              _yield$request = _context2.sent;\n              data = _yield$request.data;\n              formattedData = (0, _utils.generateModelsLinks)(data);\n              collectionTypesSectionLinksArrayOfPromises = generateArrayOfPromises(formattedData.collectionTypesSectionLinks);\n              _context2.next = 10;\n              return Promise.all(collectionTypesSectionLinksArrayOfPromises);\n\n            case 10:\n              collectionTypesSectionResults = _context2.sent;\n              singleTypesSectionLinksArrayOfPromises = generateArrayOfPromises(formattedData.singleTypesSectionLinks);\n              _context2.next = 14;\n              return Promise.all(singleTypesSectionLinksArrayOfPromises);\n\n            case 14:\n              singleTypesSectionResults = _context2.sent;\n              dispatch({\n                type: 'GET_MODELS_SUCCEEDED',\n                data: formattedData\n              });\n              dispatch({\n                type: 'SET_LINK_PERMISSIONS',\n                data: {\n                  collectionTypesSectionLinks: collectionTypesSectionResults,\n                  singleTypesSectionLinks: singleTypesSectionResults\n                }\n              });\n              _context2.next = 23;\n              break;\n\n            case 19:\n              _context2.prev = 19;\n              _context2.t0 = _context2[\"catch\"](1);\n              console.error(_context2.t0);\n              strapi.notification.toggle({\n                type: 'warning',\n                message: {\n                  id: 'notification.error'\n                }\n              });\n\n            case 23:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[1, 19]]);\n    }));\n\n    return function getModels() {\n      return _ref3.apply(this, arguments);\n    };\n  }(); // Make the getModels method available for all the other plugins\n  // So they can regenerate the menu when they need\n  // It's specially used in the content type builder\n\n\n  (0, _react.useImperativeHandle)(ref, function () {\n    return {\n      getModels: getModels\n    };\n  });\n  (0, _react.useEffect)(function () {\n    var getLinksPermissions = /*#__PURE__*/function () {\n      var _ref4 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee3() {\n        var generalSectionLinksArrayOfPromises, pluginsSectionLinksArrayOfPromises, generalSectionResults, pluginsSectionResults;\n        return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                generalSectionLinksArrayOfPromises = generateArrayOfPromises(generalSectionLinks);\n                pluginsSectionLinksArrayOfPromises = generateArrayOfPromises(pluginsSectionLinks);\n                _context3.next = 4;\n                return getModels();\n\n              case 4:\n                _context3.next = 6;\n                return Promise.all(generalSectionLinksArrayOfPromises);\n\n              case 6:\n                generalSectionResults = _context3.sent;\n                _context3.next = 9;\n                return Promise.all(pluginsSectionLinksArrayOfPromises);\n\n              case 9:\n                pluginsSectionResults = _context3.sent;\n                dispatch({\n                  type: 'SET_LINK_PERMISSIONS',\n                  data: {\n                    generalSectionLinks: generalSectionResults,\n                    pluginsSectionLinks: pluginsSectionResults\n                  }\n                });\n                dispatch({\n                  type: 'TOGGLE_IS_LOADING'\n                });\n\n              case 12:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      return function getLinksPermissions() {\n        return _ref4.apply(this, arguments);\n      };\n    }();\n\n    getLinksPermissions(); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [permissions]);\n  return /*#__PURE__*/_react[\"default\"].createElement(_Wrapper[\"default\"], null, /*#__PURE__*/_react[\"default\"].createElement(_Loader[\"default\"], {\n    show: isLoading\n  }), /*#__PURE__*/_react[\"default\"].createElement(_LeftMenu.LeftMenuHeader, null), /*#__PURE__*/_react[\"default\"].createElement(_LeftMenu.LinksContainer, null, collectTypesSectionLinksFiltered.length > 0 && /*#__PURE__*/_react[\"default\"].createElement(_LeftMenu.LeftMenuLinksSection, {\n    section: \"collectionType\",\n    name: \"collectionType\",\n    links: collectTypesSectionLinksFiltered,\n    location: location,\n    searchable: true\n  }), singleTypesSectionLinksFiltered.length > 0 && /*#__PURE__*/_react[\"default\"].createElement(_LeftMenu.LeftMenuLinksSection, {\n    section: \"singleType\",\n    name: \"singleType\",\n    links: singleTypesSectionLinksFiltered,\n    location: location,\n    searchable: true\n  }), pluginsSectionLinksFiltered.length > 0 && /*#__PURE__*/_react[\"default\"].createElement(_LeftMenu.LeftMenuLinksSection, {\n    section: \"plugins\",\n    name: \"plugins\",\n    links: pluginsSectionLinksFiltered,\n    location: location,\n    searchable: false,\n    emptyLinksListMessage: \"app.components.LeftMenuLinkContainer.noPluginsInstalled\"\n  }), generalSectionLinksFiltered.length > 0 && /*#__PURE__*/_react[\"default\"].createElement(_LeftMenu.LeftMenuLinksSection, {\n    section: \"general\",\n    name: \"general\",\n    links: generalSectionLinksFiltered,\n    location: location,\n    searchable: false\n  })), /*#__PURE__*/_react[\"default\"].createElement(_LeftMenu.LeftMenuFooter, {\n    key: \"footer\",\n    version: version\n  }));\n});\nLeftMenu.propTypes = {\n  shouldUpdateStrapi: _propTypes[\"default\"].bool.isRequired,\n  version: _propTypes[\"default\"].string.isRequired,\n  plugins: _propTypes[\"default\"].object.isRequired\n};\n\nvar _default = /*#__PURE__*/(0, _react.memo)(LeftMenu);\n\nexports[\"default\"] = _default;","map":{"version":3,"sources":["D:/webstorm_projects/redcat_backend/.cache/admin/src/containers/LeftMenu/index.js"],"names":["LeftMenu","ref","shouldUpdateStrapi","version","plugins","location","permissions","UserContext","settingsMenu","menu","settingsLinkNotificationCount","reducer","initialState","collectionTypesSectionLinks","generalSectionLinks","isLoading","pluginsSectionLinks","singleTypesSectionLinks","dispatch","generalSectionLinksFiltered","pluginsSectionLinksFiltered","singleTypesSectionLinksFiltered","collectTypesSectionLinksFiltered","checkPermissions","index","permissionsToCheck","hasPermission","generateArrayOfPromises","array","map","_","getModels","requestURL","method","data","formattedData","collectionTypesSectionLinksArrayOfPromises","Promise","all","collectionTypesSectionResults","singleTypesSectionLinksArrayOfPromises","singleTypesSectionResults","type","console","error","strapi","notification","toggle","message","id","getLinksPermissions","generalSectionLinksArrayOfPromises","pluginsSectionLinksArrayOfPromises","generalSectionResults","pluginsSectionResults","length","propTypes","PropTypes","bool","isRequired","string","object"],"mappings":"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","sourcesContent":["/*\n *\n * LeftMenu\n *\n */\n\nimport React, {\n  forwardRef,\n  memo,\n  useContext,\n  useEffect,\n  useImperativeHandle,\n  useMemo,\n  useReducer,\n} from 'react';\nimport PropTypes from 'prop-types';\nimport { useLocation } from 'react-router-dom';\n\nimport { UserContext, hasPermissions, request } from 'strapi-helper-plugin';\nimport {\n  LeftMenuLinksSection,\n  LeftMenuFooter,\n  LeftMenuHeader,\n  LinksContainer,\n} from '../../components/LeftMenu';\nimport { useSettingsMenu } from '../../hooks';\nimport { generateModelsLinks, filterLinks } from './utils';\nimport init from './init';\nimport reducer, { initialState } from './reducer';\nimport Loader from './Loader';\nimport Wrapper from './Wrapper';\n\nconst LeftMenu = forwardRef(({ shouldUpdateStrapi, version, plugins }, ref) => {\n  const location = useLocation();\n  const permissions = useContext(UserContext);\n  const { menu: settingsMenu } = useSettingsMenu(true);\n\n  // TODO: this needs to be added to the settings API in the v4\n  const settingsLinkNotificationCount = useMemo(() => {\n    if (shouldUpdateStrapi) {\n      return 1;\n    }\n\n    return 0;\n  }, [shouldUpdateStrapi]);\n  const [\n    {\n      collectionTypesSectionLinks,\n      generalSectionLinks,\n      isLoading,\n      pluginsSectionLinks,\n      singleTypesSectionLinks,\n    },\n    dispatch,\n  ] = useReducer(reducer, initialState, () =>\n    init(initialState, plugins, settingsMenu, settingsLinkNotificationCount)\n  );\n  const generalSectionLinksFiltered = useMemo(() => filterLinks(generalSectionLinks), [\n    generalSectionLinks,\n  ]);\n  const pluginsSectionLinksFiltered = useMemo(() => filterLinks(pluginsSectionLinks), [\n    pluginsSectionLinks,\n  ]);\n\n  const singleTypesSectionLinksFiltered = useMemo(() => filterLinks(singleTypesSectionLinks), [\n    singleTypesSectionLinks,\n  ]);\n  const collectTypesSectionLinksFiltered = useMemo(() => filterLinks(collectionTypesSectionLinks), [\n    collectionTypesSectionLinks,\n  ]);\n\n  // TODO:\n  // This is making a lot of request especially for the Author role as all permissions are being sent to\n  // to the backend.\n  // We should improve this by sending one request in with all permissions in bulk using the\n  // findMatchingPermissions util from the helper plugin and the /users/me/permissions endPoint\n  const checkPermissions = async (index, permissionsToCheck) => {\n    const hasPermission = await hasPermissions(permissions, permissionsToCheck);\n\n    return { index, hasPermission };\n  };\n\n  const generateArrayOfPromises = array =>\n    array.map((_, index) => checkPermissions(index, array[index].permissions));\n\n  const getModels = async () => {\n    const requestURL = '/content-manager/content-types';\n\n    try {\n      const { data } = await request(requestURL, { method: 'GET' });\n\n      const formattedData = generateModelsLinks(data);\n\n      const collectionTypesSectionLinksArrayOfPromises = generateArrayOfPromises(\n        formattedData.collectionTypesSectionLinks\n      );\n      const collectionTypesSectionResults = await Promise.all(\n        collectionTypesSectionLinksArrayOfPromises\n      );\n\n      const singleTypesSectionLinksArrayOfPromises = generateArrayOfPromises(\n        formattedData.singleTypesSectionLinks\n      );\n      const singleTypesSectionResults = await Promise.all(singleTypesSectionLinksArrayOfPromises);\n\n      dispatch({\n        type: 'GET_MODELS_SUCCEEDED',\n        data: formattedData,\n      });\n\n      dispatch({\n        type: 'SET_LINK_PERMISSIONS',\n        data: {\n          collectionTypesSectionLinks: collectionTypesSectionResults,\n          singleTypesSectionLinks: singleTypesSectionResults,\n        },\n      });\n    } catch (err) {\n      console.error(err);\n      strapi.notification.toggle({\n        type: 'warning',\n        message: { id: 'notification.error' },\n      });\n    }\n  };\n\n  // Make the getModels method available for all the other plugins\n  // So they can regenerate the menu when they need\n  // It's specially used in the content type builder\n  useImperativeHandle(ref, () => ({\n    getModels,\n  }));\n\n  useEffect(() => {\n    const getLinksPermissions = async () => {\n      const generalSectionLinksArrayOfPromises = generateArrayOfPromises(generalSectionLinks);\n      const pluginsSectionLinksArrayOfPromises = generateArrayOfPromises(pluginsSectionLinks);\n\n      await getModels();\n\n      const generalSectionResults = await Promise.all(generalSectionLinksArrayOfPromises);\n      const pluginsSectionResults = await Promise.all(pluginsSectionLinksArrayOfPromises);\n\n      dispatch({\n        type: 'SET_LINK_PERMISSIONS',\n        data: {\n          generalSectionLinks: generalSectionResults,\n          pluginsSectionLinks: pluginsSectionResults,\n        },\n      });\n\n      dispatch({\n        type: 'TOGGLE_IS_LOADING',\n      });\n    };\n\n    getLinksPermissions();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [permissions]);\n\n  return (\n    <Wrapper>\n      <Loader show={isLoading} />\n      <LeftMenuHeader />\n      <LinksContainer>\n        {collectTypesSectionLinksFiltered.length > 0 && (\n          <LeftMenuLinksSection\n            section=\"collectionType\"\n            name=\"collectionType\"\n            links={collectTypesSectionLinksFiltered}\n            location={location}\n            searchable\n          />\n        )}\n        {singleTypesSectionLinksFiltered.length > 0 && (\n          <LeftMenuLinksSection\n            section=\"singleType\"\n            name=\"singleType\"\n            links={singleTypesSectionLinksFiltered}\n            location={location}\n            searchable\n          />\n        )}\n\n        {pluginsSectionLinksFiltered.length > 0 && (\n          <LeftMenuLinksSection\n            section=\"plugins\"\n            name=\"plugins\"\n            links={pluginsSectionLinksFiltered}\n            location={location}\n            searchable={false}\n            emptyLinksListMessage=\"app.components.LeftMenuLinkContainer.noPluginsInstalled\"\n          />\n        )}\n        {generalSectionLinksFiltered.length > 0 && (\n          <LeftMenuLinksSection\n            section=\"general\"\n            name=\"general\"\n            links={generalSectionLinksFiltered}\n            location={location}\n            searchable={false}\n          />\n        )}\n      </LinksContainer>\n      <LeftMenuFooter key=\"footer\" version={version} />\n    </Wrapper>\n  );\n});\n\nLeftMenu.propTypes = {\n  shouldUpdateStrapi: PropTypes.bool.isRequired,\n  version: PropTypes.string.isRequired,\n  plugins: PropTypes.object.isRequired,\n};\n\nexport default memo(LeftMenu);\n"]},"metadata":{},"sourceType":"script"}