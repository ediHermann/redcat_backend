{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _lodash = require(\"lodash\");\n\nvar _reactFastCompare = _interopRequireDefault(require(\"react-fast-compare\"));\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _custom = require(\"@buffetjs/custom\");\n\nvar _strapiHelperPlugin = require(\"strapi-helper-plugin\");\n\nvar _hooks = require(\"../../hooks\");\n\nvar _utils = require(\"../../utils\");\n\nvar _InputJSONWithErrors = _interopRequireDefault(require(\"../InputJSONWithErrors\"));\n\nvar _SelectWrapper = _interopRequireDefault(require(\"../SelectWrapper\"));\n\nvar _WysiwygWithErrors = _interopRequireDefault(require(\"../WysiwygWithErrors\"));\n\nvar _InputUID = _interopRequireDefault(require(\"../InputUID\"));\n\nvar _utils2 = require(\"./utils\");\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction Inputs(_ref) {\n  var allowedFields = _ref.allowedFields,\n      autoFocus = _ref.autoFocus,\n      isCreatingEntry = _ref.isCreatingEntry,\n      keys = _ref.keys,\n      onBlur = _ref.onBlur,\n      formErrors = _ref.formErrors,\n      onChange = _ref.onChange,\n      readableFields = _ref.readableFields,\n      shouldNotRunValidations = _ref.shouldNotRunValidations,\n      queryInfos = _ref.queryInfos,\n      value = _ref.value,\n      fieldSchema = _ref.fieldSchema,\n      metadatas = _ref.metadatas;\n\n  var _useStrapi = (0, _strapiHelperPlugin.useStrapi)(),\n      fieldApi = _useStrapi.strapi.fieldApi;\n\n  var _useContentTypeLayout = (0, _hooks.useContentTypeLayout)(),\n      currentContentTypeLayout = _useContentTypeLayout.contentType;\n\n  var _useIntl = (0, _reactIntl.useIntl)(),\n      formatMessage = _useIntl.formatMessage;\n\n  var disabled = (0, _react.useMemo)(function () {\n    return !(0, _lodash.get)(metadatas, 'editable', true);\n  }, [metadatas]);\n  var type = fieldSchema.type;\n  var errorId = (0, _react.useMemo)(function () {\n    return (0, _lodash.get)(formErrors, [keys, 'id'], null);\n  }, [formErrors, keys]);\n  var errorMessage = errorId ? formatMessage({\n    id: errorId,\n    defaultMessage: errorId\n  }) : null;\n  var fieldName = (0, _react.useMemo)(function () {\n    return (0, _utils.getFieldName)(keys);\n  }, [keys]);\n  var validations = (0, _react.useMemo)(function () {\n    var inputValidations = (0, _lodash.omit)(fieldSchema, shouldNotRunValidations ? [].concat((0, _toConsumableArray2[\"default\"])(_utils2.VALIDATIONS_TO_OMIT), ['required', 'minLength']) : _utils2.VALIDATIONS_TO_OMIT);\n    var regexpString = fieldSchema.regex || null;\n\n    if (regexpString) {\n      var regexp = new RegExp(regexpString);\n\n      if (regexp) {\n        inputValidations.regex = regexp;\n      }\n    }\n\n    return inputValidations;\n  }, [fieldSchema, shouldNotRunValidations]);\n  var isRequired = (0, _react.useMemo)(function () {\n    return (0, _lodash.get)(validations, ['required'], false);\n  }, [validations]);\n  var isChildOfDynamicZone = (0, _react.useMemo)(function () {\n    var attributes = (0, _lodash.get)(currentContentTypeLayout, ['attributes'], {});\n    var foundAttributeType = (0, _lodash.get)(attributes, [fieldName[0], 'type'], null);\n    return foundAttributeType === 'dynamiczone';\n  }, [currentContentTypeLayout, fieldName]);\n  var inputType = (0, _react.useMemo)(function () {\n    return (0, _utils2.getInputType)(type);\n  }, [type]);\n  var inputValue = (0, _react.useMemo)(function () {\n    // Fix for input file multipe\n    if (type === 'media' && !value) {\n      return [];\n    }\n\n    return value;\n  }, [type, value]);\n  var step = (0, _react.useMemo)(function () {\n    return (0, _utils2.getStep)(type);\n  }, [type]);\n  var isUserAllowedToEditField = (0, _react.useMemo)(function () {\n    var joinedName = fieldName.join('.');\n\n    if (allowedFields.includes(joinedName)) {\n      return true;\n    }\n\n    if (isChildOfDynamicZone) {\n      return allowedFields.includes(fieldName[0]);\n    }\n\n    var isChildOfComponent = fieldName.length > 1;\n\n    if (isChildOfComponent) {\n      var parentFieldName = (0, _lodash.take)(fieldName, fieldName.length - 1).join('.');\n      return allowedFields.includes(parentFieldName);\n    }\n\n    return false;\n  }, [allowedFields, fieldName, isChildOfDynamicZone]);\n  var isUserAllowedToReadField = (0, _react.useMemo)(function () {\n    var joinedName = fieldName.join('.');\n\n    if (readableFields.includes(joinedName)) {\n      return true;\n    }\n\n    if (isChildOfDynamicZone) {\n      return readableFields.includes(fieldName[0]);\n    }\n\n    var isChildOfComponent = fieldName.length > 1;\n\n    if (isChildOfComponent) {\n      var parentFieldName = (0, _lodash.take)(fieldName, fieldName.length - 1).join('.');\n      return readableFields.includes(parentFieldName);\n    }\n\n    return false;\n  }, [readableFields, fieldName, isChildOfDynamicZone]);\n  var shouldDisplayNotAllowedInput = (0, _react.useMemo)(function () {\n    return isUserAllowedToReadField || isUserAllowedToEditField;\n  }, [isUserAllowedToEditField, isUserAllowedToReadField]);\n  var shouldDisableField = (0, _react.useMemo)(function () {\n    if (!isCreatingEntry) {\n      var doesNotHaveRight = isUserAllowedToReadField && !isUserAllowedToEditField;\n\n      if (doesNotHaveRight) {\n        return true;\n      }\n\n      return disabled;\n    }\n\n    return disabled;\n  }, [disabled, isCreatingEntry, isUserAllowedToEditField, isUserAllowedToReadField]);\n  var options = (0, _react.useMemo)(function () {\n    return (0, _utils2.generateOptions)(fieldSchema[\"enum\"] || [], isRequired);\n  }, [fieldSchema, isRequired]);\n  var otherFields = (0, _react.useMemo)(function () {\n    return fieldApi.getFields();\n  }, [fieldApi]);\n  var description = metadatas.description,\n      visible = metadatas.visible;\n\n  if (visible === false) {\n    return null;\n  }\n\n  if (!shouldDisplayNotAllowedInput) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.NotAllowedInput, {\n      label: metadatas.label\n    });\n  }\n\n  if (type === 'relation') {\n    return /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n      key: keys\n    }, /*#__PURE__*/_react[\"default\"].createElement(_SelectWrapper[\"default\"], (0, _extends2[\"default\"])({}, metadatas, fieldSchema, {\n      isUserAllowedToEditField: isUserAllowedToEditField,\n      isUserAllowedToReadField: isUserAllowedToReadField,\n      name: keys,\n      queryInfos: queryInfos,\n      value: value\n    })));\n  }\n\n  return /*#__PURE__*/_react[\"default\"].createElement(_custom.Inputs, (0, _extends2[\"default\"])({}, metadatas, {\n    autoComplete: \"new-password\",\n    autoFocus: autoFocus,\n    disabled: shouldDisableField,\n    error: errorMessage,\n    inputDescription: description,\n    description: description,\n    contentTypeUID: currentContentTypeLayout.uid,\n    customInputs: _objectSpread({\n      json: _InputJSONWithErrors[\"default\"],\n      wysiwyg: _WysiwygWithErrors[\"default\"],\n      uid: _InputUID[\"default\"]\n    }, otherFields),\n    multiple: fieldSchema.multiple || false,\n    attribute: fieldSchema,\n    name: keys,\n    onBlur: onBlur,\n    onChange: onChange,\n    options: options,\n    step: step,\n    type: inputType,\n    validations: validations,\n    value: inputValue,\n    withDefaultValue: false\n  }));\n}\n\nInputs.defaultProps = {\n  autoFocus: false,\n  formErrors: {},\n  onBlur: null,\n  queryInfos: {},\n  value: null\n};\nInputs.propTypes = {\n  allowedFields: _propTypes[\"default\"].array.isRequired,\n  autoFocus: _propTypes[\"default\"].bool,\n  fieldSchema: _propTypes[\"default\"].object.isRequired,\n  keys: _propTypes[\"default\"].string.isRequired,\n  isCreatingEntry: _propTypes[\"default\"].bool.isRequired,\n  formErrors: _propTypes[\"default\"].object,\n  metadatas: _propTypes[\"default\"].object.isRequired,\n  onBlur: _propTypes[\"default\"].func,\n  onChange: _propTypes[\"default\"].func.isRequired,\n  readableFields: _propTypes[\"default\"].array.isRequired,\n  shouldNotRunValidations: _propTypes[\"default\"].bool.isRequired,\n  queryInfos: _propTypes[\"default\"].shape({\n    containsKey: _propTypes[\"default\"].string,\n    defaultParams: _propTypes[\"default\"].object,\n    endPoint: _propTypes[\"default\"].string\n  }),\n  value: _propTypes[\"default\"].any\n};\nvar Memoized = /*#__PURE__*/(0, _react.memo)(Inputs, _reactFastCompare[\"default\"]);\n\nvar _default = (0, _utils2.connect)(Memoized, _utils2.select);\n\nexports[\"default\"] = _default;","map":{"version":3,"sources":["D:/webstorm_projects/redcat_backend/.cache/plugins/strapi-plugin-content-manager/admin/src/components/Inputs/index.js"],"names":["Inputs","allowedFields","autoFocus","isCreatingEntry","keys","onBlur","formErrors","onChange","readableFields","shouldNotRunValidations","queryInfos","value","fieldSchema","metadatas","fieldApi","strapi","currentContentTypeLayout","contentType","formatMessage","disabled","type","errorId","errorMessage","id","defaultMessage","fieldName","validations","inputValidations","VALIDATIONS_TO_OMIT","regexpString","regex","regexp","RegExp","isRequired","isChildOfDynamicZone","attributes","foundAttributeType","inputType","inputValue","step","isUserAllowedToEditField","joinedName","join","includes","isChildOfComponent","length","parentFieldName","isUserAllowedToReadField","shouldDisplayNotAllowedInput","shouldDisableField","doesNotHaveRight","options","otherFields","getFields","description","visible","label","uid","json","InputJSONWithErrors","wysiwyg","WysiwygWithErrors","InputUID","multiple","defaultProps","propTypes","PropTypes","array","bool","object","string","func","shape","containsKey","defaultParams","endPoint","any","Memoized","isEqual","select"],"mappings":"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","sourcesContent":["import React, { memo, useMemo } from 'react';\nimport PropTypes from 'prop-types';\nimport { get, omit, take } from 'lodash';\nimport isEqual from 'react-fast-compare';\nimport { useIntl } from 'react-intl';\nimport { Inputs as InputsIndex } from '@buffetjs/custom';\nimport { NotAllowedInput, useStrapi } from 'strapi-helper-plugin';\nimport { useContentTypeLayout } from '../../hooks';\nimport { getFieldName } from '../../utils';\nimport InputJSONWithErrors from '../InputJSONWithErrors';\nimport SelectWrapper from '../SelectWrapper';\nimport WysiwygWithErrors from '../WysiwygWithErrors';\nimport InputUID from '../InputUID';\nimport {\n  connect,\n  generateOptions,\n  getInputType,\n  getStep,\n  select,\n  VALIDATIONS_TO_OMIT,\n} from './utils';\n\nfunction Inputs({\n  allowedFields,\n  autoFocus,\n  isCreatingEntry,\n  keys,\n  onBlur,\n  formErrors,\n  onChange,\n  readableFields,\n  shouldNotRunValidations,\n  queryInfos,\n  value,\n  fieldSchema,\n  metadatas,\n}) {\n  const {\n    strapi: { fieldApi },\n  } = useStrapi();\n  const { contentType: currentContentTypeLayout } = useContentTypeLayout();\n  const { formatMessage } = useIntl();\n\n  const disabled = useMemo(() => !get(metadatas, 'editable', true), [metadatas]);\n  const type = fieldSchema.type;\n\n  const errorId = useMemo(() => {\n    return get(formErrors, [keys, 'id'], null);\n  }, [formErrors, keys]);\n\n  const errorMessage = errorId ? formatMessage({ id: errorId, defaultMessage: errorId }) : null;\n\n  const fieldName = useMemo(() => {\n    return getFieldName(keys);\n  }, [keys]);\n\n  const validations = useMemo(() => {\n    const inputValidations = omit(\n      fieldSchema,\n      shouldNotRunValidations\n        ? [...VALIDATIONS_TO_OMIT, 'required', 'minLength']\n        : VALIDATIONS_TO_OMIT\n    );\n\n    const regexpString = fieldSchema.regex || null;\n\n    if (regexpString) {\n      const regexp = new RegExp(regexpString);\n\n      if (regexp) {\n        inputValidations.regex = regexp;\n      }\n    }\n\n    return inputValidations;\n  }, [fieldSchema, shouldNotRunValidations]);\n\n  const isRequired = useMemo(() => get(validations, ['required'], false), [validations]);\n\n  const isChildOfDynamicZone = useMemo(() => {\n    const attributes = get(currentContentTypeLayout, ['attributes'], {});\n    const foundAttributeType = get(attributes, [fieldName[0], 'type'], null);\n\n    return foundAttributeType === 'dynamiczone';\n  }, [currentContentTypeLayout, fieldName]);\n\n  const inputType = useMemo(() => {\n    return getInputType(type);\n  }, [type]);\n\n  const inputValue = useMemo(() => {\n    // Fix for input file multipe\n    if (type === 'media' && !value) {\n      return [];\n    }\n\n    return value;\n  }, [type, value]);\n\n  const step = useMemo(() => {\n    return getStep(type);\n  }, [type]);\n\n  const isUserAllowedToEditField = useMemo(() => {\n    const joinedName = fieldName.join('.');\n\n    if (allowedFields.includes(joinedName)) {\n      return true;\n    }\n\n    if (isChildOfDynamicZone) {\n      return allowedFields.includes(fieldName[0]);\n    }\n\n    const isChildOfComponent = fieldName.length > 1;\n\n    if (isChildOfComponent) {\n      const parentFieldName = take(fieldName, fieldName.length - 1).join('.');\n\n      return allowedFields.includes(parentFieldName);\n    }\n\n    return false;\n  }, [allowedFields, fieldName, isChildOfDynamicZone]);\n\n  const isUserAllowedToReadField = useMemo(() => {\n    const joinedName = fieldName.join('.');\n\n    if (readableFields.includes(joinedName)) {\n      return true;\n    }\n\n    if (isChildOfDynamicZone) {\n      return readableFields.includes(fieldName[0]);\n    }\n\n    const isChildOfComponent = fieldName.length > 1;\n\n    if (isChildOfComponent) {\n      const parentFieldName = take(fieldName, fieldName.length - 1).join('.');\n\n      return readableFields.includes(parentFieldName);\n    }\n\n    return false;\n  }, [readableFields, fieldName, isChildOfDynamicZone]);\n\n  const shouldDisplayNotAllowedInput = useMemo(() => {\n    return isUserAllowedToReadField || isUserAllowedToEditField;\n  }, [isUserAllowedToEditField, isUserAllowedToReadField]);\n\n  const shouldDisableField = useMemo(() => {\n    if (!isCreatingEntry) {\n      const doesNotHaveRight = isUserAllowedToReadField && !isUserAllowedToEditField;\n\n      if (doesNotHaveRight) {\n        return true;\n      }\n\n      return disabled;\n    }\n\n    return disabled;\n  }, [disabled, isCreatingEntry, isUserAllowedToEditField, isUserAllowedToReadField]);\n\n  const options = useMemo(() => generateOptions(fieldSchema.enum || [], isRequired), [\n    fieldSchema,\n    isRequired,\n  ]);\n\n  const otherFields = useMemo(() => {\n    return fieldApi.getFields();\n  }, [fieldApi]);\n\n  const { description, visible } = metadatas;\n\n  if (visible === false) {\n    return null;\n  }\n\n  if (!shouldDisplayNotAllowedInput) {\n    return <NotAllowedInput label={metadatas.label} />;\n  }\n\n  if (type === 'relation') {\n    return (\n      <div key={keys}>\n        <SelectWrapper\n          {...metadatas}\n          {...fieldSchema}\n          isUserAllowedToEditField={isUserAllowedToEditField}\n          isUserAllowedToReadField={isUserAllowedToReadField}\n          name={keys}\n          queryInfos={queryInfos}\n          value={value}\n        />\n      </div>\n    );\n  }\n\n  return (\n    <InputsIndex\n      {...metadatas}\n      autoComplete=\"new-password\"\n      autoFocus={autoFocus}\n      disabled={shouldDisableField}\n      error={errorMessage}\n      inputDescription={description}\n      description={description}\n      contentTypeUID={currentContentTypeLayout.uid}\n      customInputs={{\n        json: InputJSONWithErrors,\n        wysiwyg: WysiwygWithErrors,\n        uid: InputUID,\n        ...otherFields,\n      }}\n      multiple={fieldSchema.multiple || false}\n      attribute={fieldSchema}\n      name={keys}\n      onBlur={onBlur}\n      onChange={onChange}\n      options={options}\n      step={step}\n      type={inputType}\n      validations={validations}\n      value={inputValue}\n      withDefaultValue={false}\n    />\n  );\n}\n\nInputs.defaultProps = {\n  autoFocus: false,\n\n  formErrors: {},\n  onBlur: null,\n  queryInfos: {},\n  value: null,\n};\n\nInputs.propTypes = {\n  allowedFields: PropTypes.array.isRequired,\n  autoFocus: PropTypes.bool,\n  fieldSchema: PropTypes.object.isRequired,\n  keys: PropTypes.string.isRequired,\n  isCreatingEntry: PropTypes.bool.isRequired,\n  formErrors: PropTypes.object,\n  metadatas: PropTypes.object.isRequired,\n  onBlur: PropTypes.func,\n  onChange: PropTypes.func.isRequired,\n  readableFields: PropTypes.array.isRequired,\n  shouldNotRunValidations: PropTypes.bool.isRequired,\n  queryInfos: PropTypes.shape({\n    containsKey: PropTypes.string,\n    defaultParams: PropTypes.object,\n    endPoint: PropTypes.string,\n  }),\n  value: PropTypes.any,\n};\n\nconst Memoized = memo(Inputs, isEqual);\n\nexport default connect(Memoized, select);\n"]},"metadata":{},"sourceType":"script"}