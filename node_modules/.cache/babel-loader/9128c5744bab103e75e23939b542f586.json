{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _init = _interopRequireDefault(require(\"ee_else_ce/components/Roles/Permissions/init\"));\n\nvar _reducer = _interopRequireWildcard(require(\"ee_else_ce/components/Roles/Permissions/reducer\"));\n\nvar _Tabs = _interopRequireDefault(require(\"../Tabs\"));\n\nvar _ContentTypes = _interopRequireDefault(require(\"./ContentTypes\"));\n\nvar _PluginsAndSettingsPermissions = _interopRequireDefault(require(\"./PluginsAndSettingsPermissions\"));\n\nvar _utils = require(\"../../../utils\");\n\nvar _hooks = require(\"../../../hooks\");\n\nvar _PermissionsProvider = _interopRequireDefault(require(\"./PermissionsProvider\"));\n\nvar _utils2 = require(\"./utils\");\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar Permissions = /*#__PURE__*/(0, _react.forwardRef)(function (_ref, ref) {\n  var role = _ref.role,\n      permissionsLayout = _ref.permissionsLayout,\n      rolePermissions = _ref.rolePermissions;\n\n  var _useModels = (0, _hooks.useModels)(),\n      singleTypes = _useModels.singleTypes,\n      collectionTypes = _useModels.collectionTypes,\n      components = _useModels.components;\n\n  var _useReducer = (0, _react.useReducer)(_reducer[\"default\"], _reducer.initialState, function (state) {\n    return (0, _init[\"default\"])(state, permissionsLayout, rolePermissions, role);\n  }),\n      _useReducer2 = (0, _slicedToArray2[\"default\"])(_useReducer, 2),\n      state = _useReducer2[0],\n      dispatch = _useReducer2[1];\n\n  (0, _react.useImperativeHandle)(ref, function () {\n    return {\n      getPermissions: function getPermissions() {\n        return {\n          contentTypesPermissions: state.contentTypesPermissions,\n          pluginsAndSettingsPermissions: state.pluginsAndSettingsPermissions\n        };\n      },\n      resetForm: function resetForm() {\n        dispatch({\n          type: 'ON_RESET',\n          initialPermissions: rolePermissions\n        });\n      },\n      setFormAfterSubmit: function setFormAfterSubmit() {\n        dispatch({\n          type: 'ON_SUBMIT_SUCCEEDED'\n        });\n      }\n    };\n  });\n  var allSingleTypesAttributes = (0, _react.useMemo)(function () {\n    return (0, _utils2.getAllAttributes)(singleTypes, components);\n  }, [components, singleTypes]);\n  var allCollectionTypesAttributes = (0, _react.useMemo)(function () {\n    return (0, _utils2.getAllAttributes)(collectionTypes, components);\n  }, [components, collectionTypes]);\n  var pluginsPermissionsLayout = (0, _react.useMemo)(function () {\n    return (0, _utils2.formatPermissionsLayout)(permissionsLayout.sections.plugins, 'plugin');\n  }, [permissionsLayout]);\n  var settingsPermissionsLayout = (0, _react.useMemo)(function () {\n    return (0, _utils2.formatPermissionsLayout)(permissionsLayout.sections.settings, 'category');\n  }, [permissionsLayout]);\n\n  var providerValues = _objectSpread(_objectSpread({}, state), {}, {\n    dispatch: dispatch,\n    components: components\n  });\n\n  return /*#__PURE__*/_react[\"default\"].createElement(_PermissionsProvider[\"default\"], {\n    value: providerValues\n  }, /*#__PURE__*/_react[\"default\"].createElement(_Tabs[\"default\"], {\n    tabsLabel: _utils.roleTabsLabel\n  }, /*#__PURE__*/_react[\"default\"].createElement(_ContentTypes[\"default\"], {\n    allContentTypesAttributes: allCollectionTypesAttributes,\n    contentTypes: collectionTypes\n  }), /*#__PURE__*/_react[\"default\"].createElement(_ContentTypes[\"default\"], {\n    allContentTypesAttributes: allSingleTypesAttributes,\n    contentTypes: singleTypes\n  }), /*#__PURE__*/_react[\"default\"].createElement(_PluginsAndSettingsPermissions[\"default\"], {\n    permissionType: \"plugin\",\n    pluginsPermissionsLayout: pluginsPermissionsLayout\n  }), /*#__PURE__*/_react[\"default\"].createElement(_PluginsAndSettingsPermissions[\"default\"], {\n    permissionType: \"settings\",\n    pluginsPermissionsLayout: settingsPermissionsLayout\n  })));\n});\nPermissions.defaultProps = {\n  role: null,\n  rolePermissions: {}\n};\nPermissions.propTypes = {\n  permissionsLayout: _propTypes[\"default\"].object.isRequired,\n  rolePermissions: _propTypes[\"default\"].object,\n  role: _propTypes[\"default\"].object\n};\n\nvar _default = /*#__PURE__*/(0, _react.memo)(Permissions);\n\nexports[\"default\"] = _default;","map":{"version":3,"sources":["D:/webstorm_projects/redcat_backend/.cache/admin/src/components/Roles/Permissions/index.js"],"names":["Permissions","ref","role","permissionsLayout","rolePermissions","singleTypes","collectionTypes","components","reducer","initialState","state","dispatch","getPermissions","contentTypesPermissions","pluginsAndSettingsPermissions","resetForm","type","initialPermissions","setFormAfterSubmit","allSingleTypesAttributes","allCollectionTypesAttributes","pluginsPermissionsLayout","sections","plugins","settingsPermissionsLayout","settings","providerValues","roleTabsLabel","defaultProps","propTypes","PropTypes","object","isRequired"],"mappings":"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","sourcesContent":["import React, { memo, useReducer, forwardRef, useMemo, useImperativeHandle } from 'react';\nimport PropTypes from 'prop-types';\nimport init from 'ee_else_ce/components/Roles/Permissions/init';\nimport reducer, { initialState } from 'ee_else_ce/components/Roles/Permissions/reducer';\n\nimport Tabs from '../Tabs';\nimport ContentTypes from './ContentTypes';\nimport PluginsAndSettingsPermissions from './PluginsAndSettingsPermissions';\nimport { roleTabsLabel } from '../../../utils';\nimport { useModels } from '../../../hooks';\nimport PermissionsProvider from './PermissionsProvider';\nimport { getAllAttributes, formatPermissionsLayout } from './utils';\n\nconst Permissions = forwardRef(({ role, permissionsLayout, rolePermissions }, ref) => {\n  const { singleTypes, collectionTypes, components } = useModels();\n  const [state, dispatch] = useReducer(reducer, initialState, state =>\n    init(state, permissionsLayout, rolePermissions, role)\n  );\n\n  useImperativeHandle(ref, () => ({\n    getPermissions: () => {\n      return {\n        contentTypesPermissions: state.contentTypesPermissions,\n        pluginsAndSettingsPermissions: state.pluginsAndSettingsPermissions,\n      };\n    },\n    resetForm: () => {\n      dispatch({ type: 'ON_RESET', initialPermissions: rolePermissions });\n    },\n    setFormAfterSubmit: () => {\n      dispatch({ type: 'ON_SUBMIT_SUCCEEDED' });\n    },\n  }));\n\n  const allSingleTypesAttributes = useMemo(() => {\n    return getAllAttributes(singleTypes, components);\n  }, [components, singleTypes]);\n\n  const allCollectionTypesAttributes = useMemo(() => {\n    return getAllAttributes(collectionTypes, components);\n  }, [components, collectionTypes]);\n\n  const pluginsPermissionsLayout = useMemo(() => {\n    return formatPermissionsLayout(permissionsLayout.sections.plugins, 'plugin');\n  }, [permissionsLayout]);\n\n  const settingsPermissionsLayout = useMemo(() => {\n    return formatPermissionsLayout(permissionsLayout.sections.settings, 'category');\n  }, [permissionsLayout]);\n\n  const providerValues = {\n    ...state,\n    dispatch,\n    components,\n  };\n\n  return (\n    <PermissionsProvider value={providerValues}>\n      <Tabs tabsLabel={roleTabsLabel}>\n        <ContentTypes\n          allContentTypesAttributes={allCollectionTypesAttributes}\n          contentTypes={collectionTypes}\n        />\n        <ContentTypes\n          allContentTypesAttributes={allSingleTypesAttributes}\n          contentTypes={singleTypes}\n        />\n        <PluginsAndSettingsPermissions\n          permissionType=\"plugin\"\n          pluginsPermissionsLayout={pluginsPermissionsLayout}\n        />\n        <PluginsAndSettingsPermissions\n          permissionType=\"settings\"\n          pluginsPermissionsLayout={settingsPermissionsLayout}\n        />\n      </Tabs>\n    </PermissionsProvider>\n  );\n});\n\nPermissions.defaultProps = {\n  role: null,\n  rolePermissions: {},\n};\nPermissions.propTypes = {\n  permissionsLayout: PropTypes.object.isRequired,\n  rolePermissions: PropTypes.object,\n  role: PropTypes.object,\n};\n\nexport default memo(Permissions);\n"]},"metadata":{},"sourceType":"script"}