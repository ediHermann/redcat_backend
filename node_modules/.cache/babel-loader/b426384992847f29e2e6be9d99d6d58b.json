{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _reactRouterDom = require(\"react-router-dom\");\n\nvar _lodash = require(\"lodash\");\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _strapiHelperPlugin = require(\"strapi-helper-plugin\");\n\nvar _permissions = _interopRequireDefault(require(\"../../permissions\"));\n\nvar _contexts = require(\"../../contexts\");\n\nvar _hooks = require(\"../../hooks\");\n\nvar _utils = require(\"../../utils\");\n\nvar _EditView = _interopRequireDefault(require(\"../EditView\"));\n\nvar _EditSettingsView = _interopRequireDefault(require(\"../EditSettingsView\"));\n\nvar _ListView = _interopRequireDefault(require(\"../ListView\"));\n\nvar _ListSettingsView = _interopRequireDefault(require(\"../ListSettingsView\"));\n\nvar CollectionTypeRecursivePath = function CollectionTypeRecursivePath(_ref) {\n  var _ref$match = _ref.match,\n      slug = _ref$match.params.slug,\n      url = _ref$match.url;\n\n  var _useFetchContentTypeL = (0, _hooks.useFetchContentTypeLayout)(slug),\n      isLoading = _useFetchContentTypeL.isLoading,\n      layout = _useFetchContentTypeL.layout,\n      updateLayout = _useFetchContentTypeL.updateLayout;\n\n  var _useMemo = (0, _react.useMemo)(function () {\n    var rawContentTypeLayout = {};\n    var rawComponentsLayouts = {};\n\n    if (layout.contentType) {\n      rawContentTypeLayout = (0, _utils.formatLayoutToApi)(layout.contentType);\n    }\n\n    if (layout.components) {\n      rawComponentsLayouts = Object.keys(layout.components).reduce(function (acc, current) {\n        acc[current] = (0, _utils.formatLayoutToApi)(layout.components[current]);\n        return acc;\n      }, {});\n    }\n\n    return {\n      rawContentTypeLayout: rawContentTypeLayout,\n      rawComponentsLayouts: rawComponentsLayouts\n    };\n  }, [layout]),\n      rawContentTypeLayout = _useMemo.rawContentTypeLayout,\n      rawComponentsLayouts = _useMemo.rawComponentsLayouts;\n\n  var uid = (0, _lodash.get)(layout, ['contentType', 'uid'], null); // This statement is needed in order to prevent the CollectionTypeFormWrapper effects clean up phase to be run twice.\n  // What can happen is that when navigating from one entry to another the cleanup phase of the fetch data effect is run twice : once when\n  // unmounting, once when the url changes.\n  // Since it can happen that the layout there's a delay when the layout is being fetched and the url changes adding the uid ! == slug\n  // statement prevent the component from being mounted and unmounted twice.\n\n  if (uid !== slug || isLoading) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.LoadingIndicatorPage, null);\n  }\n\n  var renderRoute = function renderRoute(_ref2, Component) {\n    var state = _ref2.location.state,\n        goBack = _ref2.history.goBack,\n        _ref2$match$params = _ref2.match.params,\n        id = _ref2$match$params.id,\n        origin = _ref2$match$params.origin;\n    return /*#__PURE__*/_react[\"default\"].createElement(Component, {\n      slug: slug,\n      layout: layout,\n      state: state,\n      goBack: goBack,\n      id: id,\n      origin: origin\n    });\n  };\n\n  var routes = [{\n    path: ':id/clone/:origin',\n    comp: _EditView[\"default\"]\n  }, {\n    path: ':id',\n    comp: _EditView[\"default\"]\n  }, {\n    path: '',\n    comp: _ListView[\"default\"]\n  }].map(function (_ref3) {\n    var path = _ref3.path,\n        comp = _ref3.comp;\n    return /*#__PURE__*/_react[\"default\"].createElement(_reactRouterDom.Route, {\n      key: path,\n      path: \"\".concat(url, \"/\").concat(path),\n      render: function render(props) {\n        return renderRoute(props, comp);\n      }\n    });\n  });\n  return /*#__PURE__*/_react[\"default\"].createElement(_contexts.ContentTypeLayoutContext.Provider, {\n    value: layout\n  }, /*#__PURE__*/_react[\"default\"].createElement(_reactRouterDom.Switch, null, /*#__PURE__*/_react[\"default\"].createElement(_reactRouterDom.Route, {\n    path: \"\".concat(url, \"/configurations/list\")\n  }, /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.CheckPagePermissions, {\n    permissions: _permissions[\"default\"].collectionTypesConfigurations\n  }, /*#__PURE__*/_react[\"default\"].createElement(_ListSettingsView[\"default\"], {\n    layout: rawContentTypeLayout,\n    slug: slug,\n    updateLayout: updateLayout\n  }))), /*#__PURE__*/_react[\"default\"].createElement(_reactRouterDom.Route, {\n    path: \"\".concat(url, \"/configurations/edit\")\n  }, /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.CheckPagePermissions, {\n    permissions: _permissions[\"default\"].collectionTypesConfigurations\n  }, /*#__PURE__*/_react[\"default\"].createElement(_EditSettingsView[\"default\"], {\n    components: rawComponentsLayouts,\n    isContentTypeView: true,\n    mainLayout: rawContentTypeLayout,\n    slug: slug,\n    updateLayout: updateLayout\n  }))), routes));\n};\n\nCollectionTypeRecursivePath.propTypes = {\n  match: _propTypes[\"default\"].shape({\n    url: _propTypes[\"default\"].string.isRequired,\n    params: _propTypes[\"default\"].shape({\n      slug: _propTypes[\"default\"].string.isRequired\n    }).isRequired\n  }).isRequired\n};\n\nvar _default = /*#__PURE__*/(0, _react.memo)(CollectionTypeRecursivePath);\n\nexports[\"default\"] = _default;","map":{"version":3,"sources":["D:/webstorm_projects/redcat_backend/.cache/plugins/strapi-plugin-content-manager/admin/src/containers/CollectionTypeRecursivePath/index.js"],"names":["CollectionTypeRecursivePath","match","slug","params","url","isLoading","layout","updateLayout","rawContentTypeLayout","rawComponentsLayouts","contentType","components","Object","keys","reduce","acc","current","uid","renderRoute","Component","state","location","goBack","history","id","origin","routes","path","comp","EditView","ListView","map","props","pluginPermissions","collectionTypesConfigurations","propTypes","PropTypes","shape","string","isRequired"],"mappings":"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","sourcesContent":["import React, { memo, useMemo } from 'react';\nimport { Switch, Route } from 'react-router-dom';\nimport { get } from 'lodash';\nimport PropTypes from 'prop-types';\nimport { LoadingIndicatorPage, CheckPagePermissions } from 'strapi-helper-plugin';\nimport pluginPermissions from '../../permissions';\nimport { ContentTypeLayoutContext } from '../../contexts';\nimport { useFetchContentTypeLayout } from '../../hooks';\nimport { formatLayoutToApi } from '../../utils';\nimport EditView from '../EditView';\nimport EditSettingsView from '../EditSettingsView';\nimport ListView from '../ListView';\nimport ListSettingsView from '../ListSettingsView';\n\nconst CollectionTypeRecursivePath = ({\n  match: {\n    params: { slug },\n    url,\n  },\n}) => {\n  const { isLoading, layout, updateLayout } = useFetchContentTypeLayout(slug);\n\n  const { rawContentTypeLayout, rawComponentsLayouts } = useMemo(() => {\n    let rawContentTypeLayout = {};\n    let rawComponentsLayouts = {};\n\n    if (layout.contentType) {\n      rawContentTypeLayout = formatLayoutToApi(layout.contentType);\n    }\n\n    if (layout.components) {\n      rawComponentsLayouts = Object.keys(layout.components).reduce((acc, current) => {\n        acc[current] = formatLayoutToApi(layout.components[current]);\n\n        return acc;\n      }, {});\n    }\n\n    return { rawContentTypeLayout, rawComponentsLayouts };\n  }, [layout]);\n\n  const uid = get(layout, ['contentType', 'uid'], null);\n\n  // This statement is needed in order to prevent the CollectionTypeFormWrapper effects clean up phase to be run twice.\n  // What can happen is that when navigating from one entry to another the cleanup phase of the fetch data effect is run twice : once when\n  // unmounting, once when the url changes.\n  // Since it can happen that the layout there's a delay when the layout is being fetched and the url changes adding the uid ! == slug\n  // statement prevent the component from being mounted and unmounted twice.\n  if (uid !== slug || isLoading) {\n    return <LoadingIndicatorPage />;\n  }\n\n  const renderRoute = (\n    {\n      location: { state },\n      history: { goBack },\n      match: {\n        params: { id, origin },\n      },\n    },\n    Component\n  ) => {\n    return (\n      <Component\n        slug={slug}\n        layout={layout}\n        state={state}\n        goBack={goBack}\n        id={id}\n        origin={origin}\n      />\n    );\n  };\n\n  const routes = [\n    { path: ':id/clone/:origin', comp: EditView },\n    { path: ':id', comp: EditView },\n    { path: '', comp: ListView },\n  ].map(({ path, comp }) => (\n    <Route key={path} path={`${url}/${path}`} render={props => renderRoute(props, comp)} />\n  ));\n\n  return (\n    <ContentTypeLayoutContext.Provider value={layout}>\n      <Switch>\n        <Route path={`${url}/configurations/list`}>\n          <CheckPagePermissions permissions={pluginPermissions.collectionTypesConfigurations}>\n            <ListSettingsView\n              layout={rawContentTypeLayout}\n              slug={slug}\n              updateLayout={updateLayout}\n            />\n          </CheckPagePermissions>\n        </Route>\n        <Route path={`${url}/configurations/edit`}>\n          <CheckPagePermissions permissions={pluginPermissions.collectionTypesConfigurations}>\n            <EditSettingsView\n              components={rawComponentsLayouts}\n              isContentTypeView\n              mainLayout={rawContentTypeLayout}\n              slug={slug}\n              updateLayout={updateLayout}\n            />\n          </CheckPagePermissions>\n        </Route>\n        {routes}\n      </Switch>\n    </ContentTypeLayoutContext.Provider>\n  );\n};\n\nCollectionTypeRecursivePath.propTypes = {\n  match: PropTypes.shape({\n    url: PropTypes.string.isRequired,\n    params: PropTypes.shape({\n      slug: PropTypes.string.isRequired,\n    }).isRequired,\n  }).isRequired,\n};\n\nexport default memo(CollectionTypeRecursivePath);\n"]},"metadata":{},"sourceType":"script"}